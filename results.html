<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700|Roboto:400,700" rel="stylesheet">
    <link href='style.css' rel='stylesheet' type='text/css'>
    <title>InfValues Results</title>
    <link rel="icon" type="x-icon" href="icon.png">
    <link rel="shortcut icon" type="x-icon" href="icon.png">
    <meta charset="utf-8">
</head>
<body>
    <h1>InfValues</h1>
    <hr>

    <h1>Results</h1>
    <br>

    <p style="width:50%;margin:-2px auto">
        Thanks for taking the test! Here are your results below.
        There are currently 45 Axes in the test. <b>This test is not completed yet.</b>
    </p>
    <br>

    <canvas id="canvas" width="956" height="5807" style="border:1px solid #d3d3d3;"></canvas>

    <p style="width:50%;margin:-2px auto">
        If you have any suggestions or opinions about this test, please fill in <a href="https://forms.gle/AA5aYwSb9MnHunMc8">this form</a>.
    </p>
    </br>

    <button class="button" onclick="location.href='index.html';" style="background-color: #2196f3;">Back</button>
    <br>

    <img id="compass" src="compass.png" alt="Image" style="display: none;" />

    <script>
        // rendering/scaling info
        const renderConfig = {
            // center (x-axis 0-point)
            xCenter: 481,

            // total x-axis width (containing values between scale start and scale end, around xCenter)
            xWidth: 960, // note: image has last approx 5 pixels cut off on the right hand side

            // 'width' of the scale (from lowest to highest possible value)
            scaleSpan: 20, // (-10 .. 10)

            // width of the marker box
            markerWidth: 120,

            // if true, the marker's edge would be touching end of scale at value=scaleMax
            // if false, the marker would be centered around end of scale at value=scaleMax
            markerKeepInside: false,
        };

        const urlParams = new URLSearchParams(window.location.search);

        // create definition of rows to be displayed on the image
        // contains: axis name (corresponding to URL), top y position and height of row
        const rowList = [
           // axisName,	y, 		height
            [ 'cap',	0,		133 ],
            [ 'auth',	133,	135 ],
            [ 'nat',	268,	135 ],
            [ 'trad',	403,	135 ],
            [ 'acc',	538,	135 ],
            [ 'relig',	673,	135 ],
            [ 'rad',	808,	135 ],
            [ 'nonv',	943,	135 ],
            [ 'noo',	1078,	135 ],
            [ 'const',	1213,	135 ],
            [ 'inter',	1348,	135 ],
            [ 'assi',	1478,	137 ],
            [ 'prag',	1615,	138 ],
            [ 'prud',	1753,	135 ],
            [ 'free',	1888,	135 ],
            [ 'pat',	2023,	134 ],
            [ 'unru',	2157,	134 ],
            [ 'imp',	2291,	134 ],
            [ 'dec',	2425,	134 ],
            [ 'nih',	2559,	135 ],
            [ 'contra',	2694,	135 ],
            [ 'gadsen',	2829,	135 ],
            [ 'spir',	2964,	137 ],
            [ 'lcen',	3101,	133 ],
            /*
            // todo:
            'pron',
            'incom',
            'clim',
            'hors',
            'ptax',
            'pmart',
            'consq',
            'enth',
            'ahs',
            ...
            */
        ] // transform the list into objects containing:
          // axisName, y, height (from above), value (from URL)
        .map(entry => {
            const axisName = entry[0];
            const urlValue = urlParams.get(axisName);
            return {
                axisName: axisName,
                value: urlValue ? parseFloat(urlValue) : null,
                y: entry[1],
                height: entry[2]
            };
        });

        function fillXCenteredRect(ctx, xCenter, y, width, height) {
            ctx.fillRect(xCenter - width/2, y, width, height);
        }

        function drawRowHighlights(ctx, rowList, config) {
            const xSpan = config.markerKeepInside
                ? (config.xWidth - config.markerWidth)
                : config.xWidth;

            const scaleToPixelsRatio = xSpan / config.scaleSpan;

            const rectWidth = config.markerWidth;

            ctx.fillStyle = "rgba(225, 225, 225, 0.55)";

            rowList
                .filter(row => row.value !== null)
                .forEach(row => {
                    const x = config.xCenter + scaleToPixelsRatio * row.value;
                    fillXCenteredRect(ctx, x, row.y, rectWidth, row.height);
                });
        }


        window.onload = function() {
            const img = document.getElementById("compass");
            const c = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");


            function redraw(canvas, ctx, img) {
                ctx.drawImage(img, 0, 0);

                drawRowHighlights(ctx, rowList, renderConfig);
            }

            redraw(c, ctx, img);
        }
    </script>
</body>
</html>
